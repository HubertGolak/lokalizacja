<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Dane z czujników iPhone</title>
</head>
<body>
  <h1>Odczyt z akcelerometru i żyroskopu</h1>
  <button onclick="startSensors()">Pokaż dane</button>

  <script>
    let listenerActive = false;

    function startSensors() {
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        DeviceMotionEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              addMotionListener();
            } else {
              alert('Brak zgody na dostęp do czujników.');
            }
          })
          .catch(error => {
            console.error(error);
            alert('Błąd przy uzyskiwaniu zgody.');
          });
      } else {
        addMotionListener();
      }
    }

    function addMotionListener() {
      if (listenerActive) return; // zapobiega wielokrotnemu dodawaniu

      const handler = function(event) {
        const acc = event.accelerationIncludingGravity;
        const rot = event.rotationRate;

        const accX = acc?.x?.toFixed(2);
        const accY = acc?.y?.toFixed(2);
        const accZ = acc?.z?.toFixed(2);

        const rotAlpha = rot?.alpha?.toFixed(2);
        const rotBeta = rot?.beta?.toFixed(2);
        const rotGamma = rot?.gamma?.toFixed(2);

        alert(
          `Akcelerometr:\nX: ${accX}\nY: ${accY}\nZ: ${accZ}\n\n` +
          `Żyroskop:\nAlpha (Z): ${rotAlpha}\nBeta (X): ${rotBeta}\nGamma (Y): ${rotGamma}`
        );

        window.removeEventListener('devicemotion', handler);
        listenerActive = false;
      };

      window.addEventListener('devicemotion', handler);
      listenerActive = true;
    }
  </script>
</body>
</html>
